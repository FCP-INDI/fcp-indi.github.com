
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Nuisance Signal Removal &#8212; C-PAC 1.4.3 Beta documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Amplitude of Low Frequency Fluctuations(ALFF) and fractional ALFF" href="alff.html" />
    <link rel="prev" title="Bootstrap Analysis of Stable Clusters" href="basc.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="alff.html" title="Amplitude of Low Frequency Fluctuations(ALFF) and fractional ALFF"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="basc.html" title="Bootstrap Analysis of Stable Clusters"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">C-PAC 1.4.3 Beta documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Workflows</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-CPAC.nuisance">
<span id="nuisance-signal-removal"></span><h1>Nuisance Signal Removal<a class="headerlink" href="#module-CPAC.nuisance" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="CPAC.nuisance.create_nuisance_workflow">
<code class="descclassname">CPAC.nuisance.</code><code class="descname">create_nuisance_workflow</code><span class="sig-paren">(</span><em>nuisance_selectors</em>, <em>use_ants</em>, <em>name='nuisance'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/CPAC/nuisance/nuisance.html#create_nuisance_workflow"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#CPAC.nuisance.create_nuisance_workflow" title="Permalink to this definition">¶</a></dt>
<dd><p>Workflow for the removal of various signals considered to be noise from resting state
fMRI data.  The residual signals for linear regression denoising is performed in a single
model.  Therefore the residual time-series will be orthogonal to all signals.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>nuisance_selectors</strong> – dictionary describing nuisance regression to be performed</li>
<li><strong>use_ants</strong> – flag indicating whether FNIRT or ANTS is used</li>
<li><strong>name</strong> – Name of the workflow, defaults to ‘nuisance’</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">nuisance : nipype.pipeline.engine.Workflow
Nuisance workflow.</p>
</td>
</tr>
</tbody>
</table>
<p>Workflow Inputs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>inputspec.functional_file_path : string (nifti file)
    Path to realigned and motion corrected functional image (nifti) file.

inputspec.functional_brain_mask_file_path : string (nifti file)
    Whole brain mask corresponding to the functional data.

inputspec.anatomical_file_path : string (nifti file)
    Corresponding preprocessed anatomical.
inputspec.wm_mask_file_path : string (nifti file)
    Corresponding white matter mask.
inputspec.csf_mask_file_path : string (nifti file)
    Corresponding cerebral spinal fluid mask.
inputspec.gm_mask_file_path : string (nifti file)
    Corresponding grey matter mask.
inputspec.lat_ventricles_mask_file_path : string (nifti file)
    Mask of lateral ventricles calculated from the Harvard Oxford Atlas.

inputspec.mni_to_anat_linear_xfm_file_path: string (nifti file)
    FLIRT Linear MNI to Anat transform
inputspec.anat_to_mni_initial_xfm_file_path: string (nifti file)
    ANTS initial transform from anat to MNI
inputspec.anat_to_mni_rigid_xfm_file_path: string (nifti file)
    ANTS rigid (6 parameter, no scaling) transform from anat to MNI
inputspec.anat_to_mni_affine_xfm_file_path: string (nifti file)
    ANTS affine (13 parameter, scales and shears) transform from anat to MNI

inputspec.func_to_anat_linear_xfm_file_path: string (nifti file)
    FLIRT Linear Transform between functional and anatomical spaces 

inputspec.motion_parameter_file_path : string (text file)
    Corresponding rigid-body motion parameters. Matrix in the file should be of shape 
    (`T`, `R`), `T` time points and `R` motion parameters.
inputspec.fd_j_file_path : string (text file)
    Framewise displacement calculated from the volume alignment.
inputspec.fd_p_file_path : string (text file)
    Framewise displacement calculated from the motion parameters.
inputspec.dvars_file_path : string (text file)
    DVARS calculated from the functional data.

inputspec.selector : Dictionary containing configuration parameters for nuisance regression.
    To not run a type of nuisance regression, it may be ommited from the dictionary.
    selector = {
        aCompCor: {
            summary: {
                method: &#39;DetrendPC&#39;, aCompCor will always extract the principal components from
                    detrended tissues signal,
                components: number of components to retain,
            },
            tissues: list of tissues to extract regressors.
                Valid values are: &#39;WhiteMatter&#39;, &#39;CerebrospinalFluid&#39;,
            extraction_resolution: None | floating point value indicating isotropic
                resolution (ex. 2 for 2mm x 2mm x 2mm that data should be extracted at,
                the corresponding tissue mask will be resampled to this resolution. The
                functional data will also be resampled to this resolution, and the
                extraction will occur at this new resolution. The goal is to avoid
                contamination from undesired tissue components when extracting nuisance
                regressors,
            erode_mask: True | False, whether or not the mask should be eroded to
                further avoid a mask overlapping with a different tissue class,
            include_delayed: True | False, whether or not to include a one-frame delay regressor,
                default to False,
            include_squared: True | False, whether or not to include a squared regressor,
                default to False,
            include_delayed_squared: True | False, whether or not to include a squared one-frame
                delay regressor, default to False,
        },
        tCompCor: {
            summary: {
                method: &#39;PC&#39;, tCompCor will always extract the principal components from
                    BOLD signal,
                components: number of components to retain,
            },
            threshold:
                floating point number = cutoff as raw variance value,
                floating point number followed by SD (ex. 1.5SD) = mean + a multiple of the SD,
                floating point number followed by PCT (ex. 2PCT) = percentile from the top (ex is top 2%),
            by_slice: True | False, whether or not the threshold criterion should be applied
                by slice or across the entire volume, makes most sense for thresholds
                using SD or PCT,
            include_delayed: True | False,
            include_squared: True | False,
            include_delayed_squared: True | False,
        },
        WhiteMatter: {
            summary: {
                method: &#39;PC&#39;, &#39;DetrendPC&#39;, &#39;Mean&#39;, &#39;NormMean&#39; or &#39;DetrendNormMean&#39;,
                components: number of components to retain, if PC,
            },
            extraction_resolution: None | floating point value (same as for aCompCor),
            erode_mask: True | False (same as for aCompCor),
            include_delayed: True | False (same as for aCompCor),
            include_squared: True | False (same as for aCompCor),
            include_delayed_squared: True | False (same as for aCompCor),
        },
        CerebrospinalFluid: {
            summary: {
                method: &#39;PC&#39;, &#39;DetrendPC&#39;, &#39;Mean&#39;, &#39;NormMean&#39; or &#39;DetrendNormMean&#39;,
                components: number of components to retain, if PC,
            },
            extraction_resolution: None | floating point value (same as for aCompCor),
            erode_mask: True | False (same as for aCompCor),
            include_delayed: True | False (same as for aCompCor),
            include_squared: True | False (same as for aCompCor),
            include_delayed_squared: True | False (same as for aCompCor),
        },
        GreyMatter: {
            summary: {
                method: &#39;PC&#39;, &#39;DetrendPC&#39;, &#39;Mean&#39;, &#39;NormMean&#39; or &#39;DetrendNormMean&#39;,
                components: number of components to retain, if PC,
            },
            extraction_resolution: None | floating point value (same as for aCompCor),
            erode_mask: True | False (same as for aCompCor),
            include_delayed: True | False (same as for aCompCor),
            include_squared: True | False (same as for aCompCor),
            include_delayed_squared: True | False (same as for aCompCor),
        },
        GlobalSignal: {
            summary: {
                method: &#39;PC&#39;, &#39;DetrendPC&#39;, &#39;Mean&#39;, &#39;NormMean&#39; or &#39;DetrendNormMean&#39;,
                components: number of components to retain, if PC,
            },
            include_delayed: True | False (same as for aCompCor),
            include_squared: True | False (same as for aCompCor),
            include_delayed_squared: True | False (same as for aCompCor),
        },
        Motion: None | { 
            include_delayed: True | False (same as for aCompCor),
            include_squared: True | False (same as for aCompCor),
            include_delayed_squared: True | False (same as for aCompCor),
        },
        Censor: {
            method: &#39;Kill&#39;, &#39;Zero&#39;, &#39;Interpolate&#39;, &#39;SpikeRegression&#39;,
            thresholds: list of dictionary, {
                type: &#39;FD_J&#39;, &#39;FD_P&#39;, &#39;DVARS&#39;,
                value: threshold value to be applied to metric
            },
            number_of_previous_trs_to_censor: integer, number of previous
                TRs to censor (remove or regress, if spike regression)
            number_of_subsequent_trs_to_censor: integer, number of
                subsequent TRs to censor (remove or regress, if spike
                regression)
        },
        PolyOrt: {
            degree: integer, polynomial degree up to which will be removed,
                e.g. 2 means constant + linear + quadratic, practically
                that is probably, the most that will be need especially
                if band pass filtering
        },
        Bandpass: {
            bottom_frequency: floating point value, frequency in hertz of
                the highpass part of the pass band, frequencies below this
                will be removed,
            top_frequency: floating point value, frequency in hertz of the
                lowpass part of the pass band, frequencies above this
                will be removed
        },
        Custom: [
            {
                file: file containing the regressors. It can be a CSV file,
                    with one regressor per column, or a Nifti image, with
                    one regressor per voxel.
                convolve: perform the convolution operation of the given
                    regressor with the timeseries.
            }
        ]
    }
</pre></div>
</div>
<p>Workflow Outputs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">outputspec</span><span class="o">.</span><span class="n">residual_file_path</span> <span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nifti</span> <span class="n">file</span><span class="p">)</span>
    <span class="n">Path</span> <span class="n">of</span> <span class="n">residual</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">nifti</span> <span class="nb">format</span>
<span class="n">outputspec</span><span class="o">.</span><span class="n">regressors_file_path</span> <span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">TSV</span> <span class="n">file</span><span class="p">)</span>
    <span class="n">Path</span> <span class="n">of</span> <span class="n">TSV</span> <span class="n">file</span> <span class="n">of</span> <span class="n">regressors</span> <span class="n">used</span><span class="o">.</span> <span class="n">Column</span> <span class="n">name</span> <span class="n">indicates</span> <span class="n">the</span> <span class="n">regressors</span> <span class="n">included</span> <span class="o">.</span>
</pre></div>
</div>
<p>Nuisance Procedure:</p>
<ol class="arabic simple">
<li>Compute nuisance regressors based on input selections.</li>
<li>Calculate residuals with respect to these nuisance regressors in a
single model for every voxel.</li>
</ol>
<p>High Level Workflow Graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<a class="reference internal image-reference" href="workflows/../images/generated/nuisance.png"><img alt="workflows/../images/generated/nuisance.png" src="workflows/../images/generated/nuisance.png" style="width: 1000px;" /></a>
<p>Detailed Workflow Graph:</p>
<a class="reference internal image-reference" href="workflows/../images/generated/nuisance_detailed.png"><img alt="workflows/../images/generated/nuisance_detailed.png" src="workflows/../images/generated/nuisance_detailed.png" style="width: 1000px;" /></a>
</dd></dl>

<dl class="function">
<dt id="CPAC.nuisance.find_offending_time_points">
<code class="descclassname">CPAC.nuisance.</code><code class="descname">find_offending_time_points</code><span class="sig-paren">(</span><em>fd_j_file_path=None</em>, <em>fd_p_file_path=None</em>, <em>dvars_file_path=None</em>, <em>fd_j_threshold=None</em>, <em>fd_p_threshold=None</em>, <em>dvars_threshold=None</em>, <em>number_of_previous_trs_to_censor=0</em>, <em>number_of_subsequent_trs_to_censor=0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/CPAC/nuisance/utils.html#find_offending_time_points"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#CPAC.nuisance.find_offending_time_points" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies criterion in method to find time points whose FD or DVARS (or both)
are above threshold.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fd_j_file_path</strong> – path to TSV containing framewise displacement as a
single column. If not specified, it will not be used.</li>
<li><strong>fd_p_file_path</strong> – path to TSV containing framewise displacement as a
single column. If not specified, it will not be used.</li>
<li><strong>dvars_file_path</strong> – path to TSV containing DVARS as a single column.
If not specified, it will not be used.</li>
<li><strong>fd_j_threshold</strong> – threshold to apply to framewise displacement (Jenkinson),
it can be a value such as 0.2 or a floating point multiple of the
standard deviation specified as, e.g. ‘1.5SD’.</li>
<li><strong>fd_p_threshold</strong> – threshold to apply to framewise displacement (Power),
it can be a value such as 0.2 or a floating point multiple of the
standard deviation specified as, e.g. ‘1.5SD’.</li>
<li><strong>dvars_threshold</strong> – threshold to apply to DVARS, can be a value such
as 0.5 or a floating point multiple of the standard deviation specified
as, e.g. ‘1.5SD’.</li>
<li><strong>number_of_previous_trs_to_censor</strong> – extent of censorship window before
the censor.</li>
<li><strong>number_of_subsequent_trs_to_censor</strong> – extent of censorship window after
the censor.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">File path to TSV file containing the volumes to be censored.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="CPAC.nuisance.generate_summarize_tissue_mask">
<code class="descclassname">CPAC.nuisance.</code><code class="descname">generate_summarize_tissue_mask</code><span class="sig-paren">(</span><em>nuisance_wf</em>, <em>pipeline_resource_pool</em>, <em>regressor_descriptor</em>, <em>regressor_selector</em>, <em>use_ants=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/CPAC/nuisance/utils.html#generate_summarize_tissue_mask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#CPAC.nuisance.generate_summarize_tissue_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Add tissue mask generation into pipeline according to the selector.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>nuisance_wf</strong> – Nuisance regressor workflow.</li>
<li><strong>pipeline_resource_pool</strong> – dictionary of available resources.</li>
<li><strong>regressor_descriptor</strong> – dictionary of steps to build, including keys:
‘tissue’, ‘resolution’, ‘erosion’</li>
<li><strong>regressor_selector</strong> – dictionary with the original selector</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the full path of the 3D nifti file containing the mask created by
this operation.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="CPAC.nuisance.bandpass_voxels">
<code class="descclassname">CPAC.nuisance.</code><code class="descname">bandpass_voxels</code><span class="sig-paren">(</span><em>realigned_file</em>, <em>bandpass_freqs</em>, <em>sample_period=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/CPAC/nuisance/bandpass.html#bandpass_voxels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#CPAC.nuisance.bandpass_voxels" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs ideal bandpass filtering on each voxel time-series.</p>
<dl class="docutils">
<dt>realigned_file <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd>Path of a realigned nifti file.</dd>
<dt>bandpass_freqs <span class="classifier-delimiter">:</span> <span class="classifier">tuple</span></dt>
<dd>Tuple containing the bandpass frequencies. (LowCutoff_HighPass HighCutoff_LowPass)</dd>
<dt>sample_period <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Length of sampling period in seconds.  If not specified,
this value is read from the nifti file provided.</dd>
</dl>
<dl class="docutils">
<dt>bandpassed_file <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd>Path of filtered output (nifti file).</dd>
</dl>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/cpac_logo_vertical.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="basc.html"
                        title="previous chapter">Bootstrap Analysis of Stable Clusters</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="alff.html"
                        title="next chapter">Amplitude of Low Frequency Fluctuations(ALFF) and fractional ALFF</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/workflows/nuisance.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="alff.html" title="Amplitude of Low Frequency Fluctuations(ALFF) and fractional ALFF"
             >next</a> |</li>
        <li class="right" >
          <a href="basc.html" title="Bootstrap Analysis of Stable Clusters"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">C-PAC 1.4.3 Beta documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Workflows</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, C-PAC Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-19224662-10"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-19224662-10');
    </script>

  </body>
</html>