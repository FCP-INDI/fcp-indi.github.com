Group-Level Statistics
----------------------
C-PAC uses `FSL/FEAT <http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FEAT/UserGuide>`_ to compare findings across groups and run statistical analysis. Users create a model file that includes group, phenotypic, and nuisance regressors for each subject, and the data is `run through a GLM <http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FEAT/UserGuide#Appendix_A:_Brief_Overview_of_GLM_Analysis>`_.

Model files can be `created manually through FSL <http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FEAT/UserGuide#FEAT_in_Detail>`_, or automatically using the C-PAC FSL Model Script and instructions below.

When you have created the necessary model files, please refer to the :doc:`Group Statistics Options page </stat_config>` for information about how to configure C-PAC for this feature.

Prepare Phenotypic Information and Other Regressors
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Phenotypic information and nuisance regressors are specified in a :file:`.csv` file, with subjects as rows and regressors as columns. A :file:`template_phenotypic.csv` is generated when you :doc:`prepare your data </use>`, and includes rows for all subjects to be included in group satistics. Open this file, create a column for each phenotypic variable or regressor you would like included in your model, and enter the appropriate value for each subject. When you are finished, save your changes. Future versions of C-PAC will automate this process.

Configure FSL Model Script
^^^^^^^^^^^^^^^^^^^^^^^^^^
Open :file:`config_fsl.py`, which can be found in the :file:`/C-PAC/utils/` folder, or `downloaded here <https://raw.github.com/FCP-INDI/C-PAC/master/CPAC/utils/config_fsl.py>`_. Enter the regressors you would like to include, the path to :file:`template_phenotypic.csv`, and a name for the .csv model file to be output. Save your changes.

Run FSL Model Script
^^^^^^^^^^^^^^^^^^^^
Open iPython and type::

    import CPAC
    CPAC.utils.create_fsl_model.run ('/path/to/config_fsl_py', 'generate_model_csv')

This will output a .csv model file with the name you specified.

Reconfigure FSL Script
^^^^^^^^^^^^^^^^^^^^^^
Based on the columns you have included in your model, create a contrast file using FSL. Specify the location of this file in :file:`config_fsl.py`, as well as a name for the model.

Run FSL Script Again
^^^^^^^^^^^^^^^^^^^^
Open iPython and type::

    import CPAC
    create_fsl_model.run ('/path/to/config_fsl_py', 'generate_model_fsl_files')

This will output the standard FSL model files in the directory from which the script is run. You may then specify the location of these files in :file:`config.py`, and :doc:`run the C-PAC group pipeline </use>`.


