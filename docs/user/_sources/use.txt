Using C-PAC
===========

Ready Your Data
---------------
Open the :file:`data_config.py` file located in the :file:`utils` directory. Follow the instructions inside to specify your directory structure. When you are done, save your changes.

In the terminal, navigate to the directory where you would like to store subject lists for use by C-PAC. Open iPython by typing :file:`ipython`. From the iPython prompt, run::

  import CPAC
  CPAC.utils.extract_data.run ('/path/to/data_config.py')

This will ouput three files needed to run C-PAC:

* :file:`CPAC_subjectlist.py`
* :file:`template_phenotypic.csv`
* :file:`subject_list_group_analysis.txt`

Configure C-PAC
---------------
Open the :file:`config.py` file located in the :file:`pipeline` directory. This is where you will specify which analyses C-PAC runs and how they are run. See the links below for detailed instructions. When you are finished, save your changes.

* :doc:`Computer Settings </compute_config>`
* :doc:`Directory Setup </dir_config>`
* :doc:`Preprocessing Setup </pp_config>`
* :doc:`Segmentation </seg_config>`
* :doc:`Nuisance Correction and Temporal Filtering </nuisance_config>`
* :doc:`Seed-based Correlation Analysis and Timeseries Extraction </sca_tse_config>`
* :doc:`Individual-Level Analyses </ind_config>`
* :doc:`Group-Level Analyses </grp_config>`
* :doc:`Group Statistics </stat_config>`

Running C-PAC
-------------
In the terminal, navigate to the crash directory you specified in :file:`config.py`. Because of a bug in Nipype, C-PAC will output crash logs from wherever it is run.

Open iPython by typing :file:`ipython`. From the iPython prompt, run::

  import CPAC
  CPAC.pipeline.cpac_runner.run ('/path/to/config.py', '/path/to/CPAC_subjectlist.py')


Data Output
-----------
C-PAC outputs data in the following structure::

  /output_directory/pipeline/strategy/subject/output/output_options/

Pipelines are combinations of workflows. For example, if you set C-PAC to process data both with and without anatomical pre-processing, you will get two separate pipelines.

A strategy is a set of preprocessing options, including smoothing width, standard resolution, and nuisance corrections. Multiple combinations of settings will result in multiple strategies.

Outputs include any measures calculated. 

Running BASC, CWAS, and Group Statistics
----------------------------------------
In order to run group statistics, you must first run C-PAC to generate the desired measures for which you wish to calculate group differences.

For BASC and CWAS, C-PAC must first be run to transform functional images to MNI space.

Open iPython by typing :file:`ipython`. From the iPython prompt, run::

  import CPAC
  CPAC.pipeline.cpac_group_runner.run ('/path/to/config.py', '/path/to/desired/strategy')


.. toctree::
   :hidden: 

   Computer Settings <compute_config>
   Directory Setup <dir_config>
   Preprocessing Setup <pp_config>
   Segmentation <seg_config>
   Nuisance Correction and Temporal Filtering <nuisance_config>
   Seed-based Correlation Analysis and Timeseries Extraction <sca_tse_config>
   Individual-Level Analyses <ind_config>
   Group-Level Analyses <grp_config>
   Group Statistics <stat_config>