Slice Timing Correction 
-----------------------
Background
^^^^^^^^^^
Most fMRI images are created by combining multiple 2D slices into a single 3D volume. Slices are acquired one after another, either sequentially in ascending or descending order, or in an interleaved manner, such that every other slice is acquired in a first pass, and the remaining slices are aqcuired in a second pass. The time between the acquisition of the first and last slice depends on the TR used (e.g. 2.5 seconds for a TR of 2500ms). Slice timing correction acts to adjust the timecourse of voxels in each slice to account for these differences. This is done by interpolating the data in each slice to match the timing of a reference slice. Slice timing correction is necessary because many statistical models used for fMRI analysis assume that all voxels are measured simultaneously. As such, differences in acqusition time between slices can cause confounds.

Slice Timing Correction Guidelines
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Whenever possible, it is desirable to avoid using slice timing correction, as it can interact with motion correction to distort data (Poldrack et al., 2011). If one must apply slice timing correction, it should be done after motion correction to minimize these distortions. However, as the BOLD response is relatively sluggish, combining interleaved acquisitions with TR times shoter than 2000ms may obviate the need for slice timing correction, even for event-related designs (Poldrack et al., 2011).

Configuring C-PAC
^^^^^^^^^^^^^^^^^
If you wish to run :doc:`Slice Timing Correction </slice>`, you must include a file that contains information about the slice acquisition order used for each subject. This file is specified when running :file:`extract_data.py` (see the :doc:`Using C-PAC </use>` page).

.. line-block::
  **If all subjects within a site have the same acquisition order:** 
  Use the template :file:`scan_parameters.csv` file available for download `here <https://raw.github.com/FCP-INDI/C-PAC/master/configs/scan_parameters.csv>`_. 

  **If subjects within a site have differeing acquisition orders:**
  Use the template :file:`scan_parameters_multiscan.csv` file available for download `here <https://raw.github.com/FCP-INDI/C-PAC/master/configs/scan_parameters_multiscan.csv>`_. 

Slice Timing information should be entered into these files as follows:

* **Site** - Site name corresponding to a site-level folder in your directory structure (e.g. :file:`site_1`).
* **Scan** - Only for :file:`scan_parameters_multiscan.csv`. Scan name corresponding to a scan-level folder in your directory structure (e.g. :file:`anat`, :file:`rest`)
* **TR** - TR in seconds.
* **Reference** - Desired reference slice (usually the middle slice).
* **Acquisition** - Acquisition order for multi-band scans.

  * **alt+z** - Interleaved ascending
  * **alt-z** - Interleaved descending
  * **seq+z** - Sequential ascending
  * **seq-z** - Sequential descending

* **FirstTR** - First volume to include in analysis. (Reminder, volumes start at 0)
* **LastTR** - Last volume to inclucde in analysis.

It should be noted that the settings specified in the files above over-ride the equivalent settings in the Timeseries Options section of :file:`config.py`.

External Resources
^^^^^^^^^^^^^^^^^^
`Slice Timing FAQ - MIT mindhive <http://mindhive.mit.edu/node/109>`_

`SliceTiming - MRC CBU Imaging Wiki <http://imaging.mrc-cbu.cam.ac.uk/imaging/SliceTiming>`_

References
^^^^^^^^^^
Poldrack, R. A., Mumford, J., & Nichols, T. (2011). Preprocessing fMRI data. In Handbook of Functional MRI Data Analysis. Cambridge: Cambridge University Press.