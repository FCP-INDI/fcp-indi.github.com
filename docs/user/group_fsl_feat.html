
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>FSL-FEAT/Randomise Group Analysis &#8212; C-PAC 1.3.0 Beta documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.3.0 Beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Bootstrapped Analysis of Stable Clusters (PyBASC)" href="group_pybasc.html" />
    <link rel="prev" title="Group-Level Analysis" href="group_analysis.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="group_pybasc.html" title="Bootstrapped Analysis of Stable Clusters (PyBASC)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="group_analysis.html" title="Group-Level Analysis"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">C-PAC 1.3.0 Beta documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="group_analysis.html" accesskey="U">Group-Level Analysis</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="fsl-feat-randomise-group-analysis">
<h1>FSL-FEAT/Randomise Group Analysis<a class="headerlink" href="#fsl-feat-randomise-group-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>C-PAC uses the <a class="reference external" href="http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FEAT/UserGuide">FSL/FEAT</a> tool to compare findings across groups. You can construct models using a participant list and a phenotype file, select derivatives to be predicted by the model, and define contrasts between conditions using either the GUI or a custom csv file. Then FSL/FEAT will run a second-level <a class="reference external" href="http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FEAT/UserGuide#Appendix_A:_Brief_Overview_of_GLM_Analysis">General Linear Model (GLM)</a> for you.</p>
<p>In addition, FMRIB’s FSL Randomise package is also available in C-PAC for the execution of non-parametric permutation inference. FSL-Randomise can use the same group models you generate or build/edit via the C-PAC model builder for FSL-FEAT.</p>
<p>There are two ways to set up FSL-FEAT/Randomise group-level analysis for C-PAC:</p>
<ul class="simple">
<li><strong>The FLAME Model Presets</strong>: this allows you to generate a pre-configured analysis model.</li>
<li><strong>The Group Analysis Model Builder</strong>: this allows you to specify a model from scratch, or to modify any of the generated presets mentioned above.</li>
</ul>
<p>The following links provide an introduction to how groups are compared using FSL, as well as how to define contrasts:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.fmrib.ox.ac.uk/fslcourse/lectures/feat1_part2.pdf">http://www.fmrib.ox.ac.uk/fslcourse/lectures/feat1_part2.pdf</a></li>
</ul>
</div>
<div class="section" id="group-analysis-fsl-feat-randomise-presets">
<h2>Group Analysis FSL-FEAT/Randomise Presets<a class="headerlink" href="#group-analysis-fsl-feat-randomise-presets" title="Permalink to this headline">¶</a></h2>
<p>C-PAC has a selection of model presets designed to run commonly-used group analysis designs for FSL-FEAT/FLAME. These correspond to examples provided on <a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FEAT/UserGuide">FSL’s user guide for FEAT/FLAME</a>. The preset generator will create a group analysis YAML configuration file that you can plug directly into C-PAC and run.</p>
<p>The presets that are generated:</p>
<ul class="simple">
<li>are meant to get you up and running quickly</li>
<li>are in the form of a group analysis configuration YAML file that can be plugged directly into C-PAC and run</li>
<li>include a complete design matrix as an input, which you can view before running</li>
<li>include already-configured contrasts in a custom contrasts .CSV file, which can be edited before running</li>
<li>can be modified to your liking either by using the standard Group Analysis Model Builder, or by hand via text editor</li>
<li>are all in one place in the output directory you specify in the Preset Generator</li>
</ul>
<p>To configure group-level analysis using a preset from the main screen of the GUI, click the “Generate FSL-FEAT Presets” button on the bottom left. This will allow you to generate a pre-set model.</p>
<p><strong>Preset options</strong>: Currently, there are 5 presets to choose from. More are on their way. If you have any commonly-used or useful group model designs you’d like to see as a preset, <a class="reference external" href="https://groups.google.com/forum/#!forum/cpax_forum">please let us know</a>!</p>
<p>The available presets are:</p>
<ul class="simple">
<li><a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FEAT/UserGuide#Single-Group_Average_.28One-Sample_T-Test.29">Single Group Average (One-Sample T-Test)</a></li>
<li><a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FEAT/UserGuide#Single-Group_Average_with_Additional_Covariate">Single Group Average with Additional Covariate</a></li>
<li><a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FEAT/UserGuide#Unpaired_Two-Group_Difference_.28Two-Sample_Unpaired_T-Test.29">Unpaired Two-Group Difference (Two-Sample Unpaired T-Test)</a></li>
<li><a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FEAT/UserGuide#Paired_Two-Group_Difference_.28Two-Sample_Paired_T-Test.29">Paired Two-Group Difference (Two-Sample Paired T-Test)</a></li>
<li><a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FEAT/UserGuide#Tripled_Two-Group_Difference_.28.22Tripled.22_T-Test.29">Tripled Two-Group Difference (‘Tripled’ T-Test)</a></li>
</ul>
<div class="section" id="using-the-gui">
<h3>Using the GUI<a class="headerlink" href="#using-the-gui" title="Permalink to this headline">¶</a></h3>
<div class="figure">
<img alt="_images/ga_main_presets.png" src="_images/ga_main_presets.png" />
</div>
<p>Start by opening the FSL group model presets from the main window of the GUI. You’ll see a window like this open:</p>
<div class="figure">
<img alt="_images/group_presets_one.png" src="_images/group_presets_one.png" />
</div>
<ol class="arabic simple">
<li><strong>Choose Preset:</strong> Select the type of preset you’d like to generate. The preset generator will prompt you for more information relevant to the type of preset you selected on the next window (except for the Single Group Average (One-Sample T-Test), which needs no additional information).</li>
<li><strong>Participant List - [path]:</strong> Full path to a list of subjects to be included in the model. This should be a text file with one subject per line.  A list in this format containing all subjects run through CPAC was generated along with the main CPAC subject list (see the subject list in <cite>Overview</cite>). Another easy way to manually create this file is to copy the subjects column from your Regressor/EV spreadsheet.</li>
<li><strong>Select Derivatives - [checkboxes]:</strong> Select which derivatives you would like to include when running group analysis. When including Dual Regression, make sure to correct your P-value for the number of maps you are comparing. When including Multiple Regression SCA, you must have more degrees of freedom (subjects) than there were time series.</li>
<li><strong>Z Threshold - [decimal]:</strong> Only voxels with a Z-score higher than this value will be considered significant.</li>
<li><strong>Cluster Significance Threshold - [decimal]:</strong> Significance threshold (P-value) to use when doing cluster correction for multiple comparisons.</li>
<li><strong>Model Name - [text]:</strong> Specify a name for the new model.</li>
<li><strong>Output Directory - [path]:</strong> Full path to the directory where CPAC should place the model files (.mat, .con, .grp, .csv) and the outputs of group analysis. The input files and the group analysis configuration YAML file generated by the preset generator will also be written here.</li>
</ol>
<div class="figure">
<img alt="_images/group_presets_two.png" src="_images/group_presets_two.png" />
</div>
<p>This window opens if you have selected any of the presets that require phenotypic information [Single Group Average with Additional Covariate, Unpaired Two-Group Difference (Two-Sample Unpaired T-Test)].</p>
<ol class="arabic simple">
<li><strong>Phenotype/EV File -[path]:</strong> Full path to a .csv file containing EV information for each subject. A file in this format (containing a single column listing all subjects run through CPAC) was generated along with the main CPAC subject list (see the phenotype file in <cite>Overview</cite>).  Levels for categorical variables in this file can be expressed as words (‘ADHD’/’TD’) or numerical values (0/1) depending on your preferences.</li>
<li><strong>Participant Column Name [text]:</strong> Name/label of the subjects column in your phenotype file.</li>
<li><strong>Two groups from pheno to compare [text]:</strong> Enter the names/labels of the two columns from your phenotype file, separated by a comma, that specify the two groups (categorical EVs) you wish to compare, OR, if the two groups are encoded in one column only (ex. Sex: M,F,F,M,.. or Diagnosis: 1,1,0,0,..), simply enter the name of that one column.</li>
</ol>
<div class="figure">
<img alt="_images/group_presets_three.png" src="_images/group_presets_three.png" />
</div>
<p>This window opens if you have selected any of the presets that compare paired/linked groups or conditions [Paired Two-Group Difference (Two-Sample Paired T-Test), Tripled Two-Group Difference (‘Tripled’ T-Test)].</p>
<ol class="arabic simple">
<li><strong>Conditions: Sessions or Series/Scans?:</strong> Choose whether the linked groups or conditions you wish to compare are separated in the data as Sessions (multiple visits into the scanner) or Series/Scans (multiple acquisitions during a single session).</li>
<li><strong>Session or Series/Scan IDs - [dialogue: list of names]:</strong> Enter the session or series/scan ID names you wish to compare. If they are sessions, they can be found under ‘unique_id’ in the individual-level data configuration YAML file for the data in question, or in the ‘participant_session’ IDs that you would see in the individual-level analysis output directory (ex. ‘3005_1’ would be participant 3005, session 1). If they are series/scans, they will be the functional scan names, which can be found in the data configuration YAML file nested under ‘func’.</li>
</ol>
<p>Once you click “Generate Model”, all of the associated files will be generated. Most importantly, it will generate a group configuration file that you can load into the ‘Pipelines’ box. You can check the terminal window for progress and details. Once complete, you can review the model generated to make sure it meets your expectations. If you wish to tweak the model generated by a preset, you can load the group configuration file into the model builder (more details below) and make any modifications necessary.</p>
<p>When you are happy with your model, you can go ahead to build the model for each of your selected derivatives:</p>
<div class="figure">
<img alt="_images/ga_main_fsl-build.png" src="_images/ga_main_fsl-build.png" />
</div>
<p>Once this is complete, a design matrix will have been generated for each derivative, session, scan, and nuisance regression strategy you had in your pipeline directory. These are available for review in the group-level analysis output directory you specified in your group configuration file (or during preset generation). In addition, a <code class="docutils literal"><span class="pre">contrasts.csv</span></code> file will be generated in the top level of the FSL group model directory (in your selected group-level analysis output directory). This contrasts file will be set up in accordance with the design matrices created for your pipeline outputs, and will look like this:</p>
<div class="figure">
<img alt="_images/ga_contrast_csv.png" src="_images/ga_contrast_csv.png" />
</div>
<p>The first column should be filled with labels for the contrasts that you can define - these do not have to follow any particular convention, and can be whatever works best for your experiment.  The remainder of the cells can be populated with contrast weights according to your needs.</p>
<p>If you would like to add f-tests, add each f-test as a column to the CSV with the label <code class="docutils literal"><span class="pre">f_test_#</span></code> and the assign weights to each contrast to be included in the f-test.</p>
<div class="figure">
<img alt="_images/ga_contrast_ftest.png" src="_images/ga_contrast_ftest.png" />
</div>
<p>Once you have specified your contrasts, you can start FSL FEAT, Randomise, or both from the GUI like so:</p>
<div class="figure">
<img alt="_images/ga_main_fsl-run.png" src="_images/ga_main_fsl-run.png" />
</div>
<p>Note, if you have group configuration options for other types of group-level analyses (ex. PyBASC, MDMR, ISC/ISFC) in the same group configuration file, C-PAC will run all of your analyses for you. You can have all of your group-level analysis setups in one group configuration file, or you can separate them if preferred- both will work.</p>
</div>
<div class="section" id="from-terminal">
<h3>From Terminal<a class="headerlink" href="#from-terminal" title="Permalink to this headline">¶</a></h3>
<p>You can generate any of these presets using the C-PAC command-line interface (CLI):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cpac group feat load_preset &lt;preset type&gt;
</pre></div>
</div>
<p>Enter any of the following in place of <code class="file docutils literal"><span class="pre">&lt;preset</span> <span class="pre">type&gt;</span></code> for the type of analysis you want to run:</p>
<ul class="simple">
<li><strong>single_grp_avg</strong> - Single Group Average (One-Sample T-Test)</li>
<li><strong>single_grp_cov</strong> - Single Group Average with Additional Covariate</li>
<li><strong>unpaired_two</strong> - Unpaired Two-Group Difference (Two-Sample Unpaired T-Test)</li>
<li><strong>paired_two</strong> - Paired Two-Group Difference (Two-Sample Paired T-Test)</li>
<li><strong>tripled_two</strong> - Tripled Two-Group Difference (‘Tripled’ T-Test)</li>
</ul>
<p>You can get more information about the required inputs for each preset with the <code class="file docutils literal"><span class="pre">--help</span></code> flag. For example, to check the parameters for a two-sample unpaired t-test:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cpac group feat load_preset unpaired_two --help
</pre></div>
</div>
<p>This will produce:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Usage: cpac group feat load_preset unpaired_two <span class="o">[</span>OPTIONS<span class="o">]</span> GROUP_PARTICIPANTS
                                                Z_THRESH P_THRESH PHENO_FILE
                                                PHENO_SUB COVARIATE MODEL_NAME
Options:
  --output_dir TEXT
  --help             Show this message and exit.
</pre></div>
</div>
<p>Following this, you could generate a ready-to-run two-sample unpaired t-test by running the following, assuming the phenotype CSV has a column of participant IDs named “subject_id” and a column named “diagnosis”, which is the covariate you wish to test:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cpac group feat load_preset unpaired_two /path/to/group_participant_list.txt 2.3 0.05
        /path/to/phenotypic_file.csv subject_id diagnosis grp_analysis1
        --output_dir /path/to/output_dir
</pre></div>
</div>
<p>You will receive a message like this shortly after:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Group-level analysis participant list written:
/path/to/output_dir/group_analysis_participants.txt

CSV file written:
/path/to/output_dir/cpac_group_analysis/grp_analysis1/design_matrix_grp_analysis1.csv

CSV file written:
/path/to/output_dir/cpac_group_analysis/grp_analysis1/contrasts_matrix_grp_analysis1.csv

Group-level analysis configuration YAML file written:
/path/to/output_dir/cpac_group_analysis/grp_analysis1/group_config_grp_analysis1.yml
</pre></div>
</div>
<p>The message indicates that all of the associated files have been generated. Most importantly, it generated a group configuration file that you can use to build and run your model. Once complete, you can review the model generated to make sure it meets your expectations. If you wish to tweak the model generated by a preset, you can load the group configuration file into the model builder (more details below) and make any modifications necessary.</p>
<p>When you are happy with your model, you can go ahead to build the model for each of your selected derivatives:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cpac group feat build-models /path/to/group_config.yml
</pre></div>
</div>
<p>Once this is complete, a design matrix will have been generated for each derivative, session, scan, and nuisance regression strategy you had in your pipeline directory. These are available for review in the group-level analysis output directory you specified in your group configuration file (or during preset generation). In addition, a <code class="docutils literal"><span class="pre">contrasts.csv</span></code> file will be generated in the top level of the FSL group model directory (in your selected group-level analysis output directory). This contrasts file will be set up in accordance with the design matrices created for your pipeline outputs, and will look like this:</p>
<div class="figure">
<img alt="_images/ga_contrast_csv.png" src="_images/ga_contrast_csv.png" />
</div>
<p>The first column should be filled with labels for the contrasts that you can define - these do not have to follow any particular convention, and can be whatever works best for your experiment.  The remainder of the cells can be populated with contrast weights according to your needs.</p>
<p>If you would like to add f-tests, add each f-test as a column to the CSV with the label <code class="docutils literal"><span class="pre">f_test_#</span></code> and the assign weights to each contrast to be included in the f-test.</p>
<div class="figure">
<img alt="_images/ga_contrast_ftest.png" src="_images/ga_contrast_ftest.png" />
</div>
<p>Once you have specified your contrasts, you can start FSL FEAT or Randomise with the commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cpac group feat run /path/to/group_config.yml
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cpac group feat randomise /path/to/group_config.yml
</pre></div>
</div>
</div>
</div>
<div class="section" id="c-pac-group-analysis-model-builder">
<h2>C-PAC Group Analysis Model Builder<a class="headerlink" href="#c-pac-group-analysis-model-builder" title="Permalink to this headline">¶</a></h2>
<p>Use the model builder to create an FSL FEAT/Randomise model from scratch, or to modify any of the generated presets.</p>
<p>To configure group-level analysis from the main screen of the GUI, click the “New Group” button to open the group-level analysis configuration editor. Navigate to the “FSL FEAT Settings” tab to specify your model. Note that this model will also work with Randomise. Specific Randomise options (number of permutations, etc.) are available on the next tab, “FSL Randomise Settings”.</p>
<div class="section" id="general-group-level-analysis-settings">
<h3>General Group-Level Analysis Settings<a class="headerlink" href="#general-group-level-analysis-settings" title="Permalink to this headline">¶</a></h3>
<div class="figure">
<img alt="_images/ga_general.png" src="_images/ga_general.png" />
</div>
<ol class="arabic simple">
<li><strong>Pipeline Directory - [path]:</strong> The main input of group-level analysis- the output directory of your individual-level analysis pipeline run (pre-processing &amp; derivatives for each participant). This should be a path to your C-PAC individual-level run’s pipeline folder, which includes the sub-directories labeled with the participant IDs.</li>
<li><strong>Participant List - [path]:</strong> (Optional) Full path to a list of participants to be included in the model. You can use this to easily prune participants from your model. In group-level analyses involving phenotype files, this allows you to prune participants without removing them from the phenotype CSV/TSV file. This should be a text file with one subject per line. An easy way to manually create this file is to copy the participant ID column from your phenotype file.</li>
<li><strong>Output Directory - [path]:</strong> Full path to the directory where CPAC should write out the results of group analysis, and also place the model files (.mat, .con, .grp, .csv). The CSV file is a human-readable version of the .mat file used by FLAME that you can use to examine the exact model that C-PAC generated.</li>
<li><strong>Working Directory - [path]:</strong> Much like the working directory for individual-level analysis, this is where the intermediate and working files will be stored during your run. This directory can be deleted later on. However, saving this directory allows the group analysis run to skip steps that have been already completed, in the case of re-runs.</li>
<li><strong>Log Directory - [path]:</strong> Where to write out log information for your group analysis run.</li>
<li><strong>FSL Directory - [text/path]:</strong> The path to your FSL installation directory. This can be left as ‘FSLDIR’ to grab your system’s default FSL installation. However, if you prefer to use a specific install of FSL, you can enter the path here.</li>
</ol>
</div>
<div class="section" id="specifying-models-to-run">
<h3>Specifying Models to Run<a class="headerlink" href="#specifying-models-to-run" title="Permalink to this headline">¶</a></h3>
<div class="figure">
<img alt="_images/ga_fsl_model1.png" src="_images/ga_fsl_model1.png" />
</div>
<ol class="arabic simple">
<li><strong>Model Name - [text]:</strong> Specify a name for the new model.</li>
<li><strong>Phenotype/EV File -[path]:</strong> Full path to a .csv file containing EV information for each subject. A file in this format (containing a single column listing all subjects run through CPAC) was generated along with the main CPAC subject list (see the phenotype file in <cite>Overview</cite>).  Levels for categorical variables in this file can be expressed as words (‘ADHD’/’TD’) or numerical values (0/1) depending on your preferences.</li>
<li><strong>Participant Column Name [text]:</strong> Name of the subjects column in your EV file.</li>
<li><strong>Model Setup - [checkboxes]:</strong> A list of EVs from your phenotype file will populate in this window. From here, you can select whether the EVs should be treated as categorical or if they should be demeaned (continuous/non-categorical EVs only). ‘MeanFD’ and ‘Measure Mean’ will also appear in this window automatically as options to be used as regressors that can be included in your model design. Note that the MeanFD and mean of measure values are automatically calculated and supplied by C-PAC via individual-level analysis. Measure mean is calculated using the mean signal from raw data rather than z-score data, which is then demeaned.  Also, MeanFD and mean of measure values are automatically demeaned prior to being inserted into the group analysis model.</li>
<li><strong>Design Matrix Formula - [Patsy formula]:</strong> Specify the formula to describe your model design. Essentially, including EVs in this formula inserts them into the model. The most basic format to include each EV you select would be ‘EV + EV + EV + ..’, etc. You can also select to include MeanFD, Measure_Mean, or an intercept here (by adding ‘ + Measure_Mean’, ‘ + MeanFD_&lt;Power/Jenkinson&gt;’ or ‘ + Intercept ‘ respectively). Note that when you add an intercept to your formula categorical variables will automatically be demeaned since this is a requirement for FLAME to run properly. This design formula is pre-generated for the user depending on the EVs in the phenotype file, but can be edited at any time. C-PAC uses the Python library Patsy to generate the design matrices, so more information on how to format your design formula for specific designs can be found here- <a class="reference external" href="https://patsy.readthedocs.org/en/latest/formulas.html">Patsy formula documentation</a>.  If you have used R in the past, Patsy’s formula syntax should be familiar.</li>
<li><strong>Custom ROI Mean Mask (optional) - [path]:</strong> Use a binarized mask with one or more ROIs to add averages for those ROIs to the model as EVs.  Mask file must be in NifTI format.  These averages will be calculated using the raw data, rather than z-scored data, and will then be demeaned afterwards.</li>
<li><strong>Select Derivatives - [checkboxes]:</strong> Select which derivatives you would like to include when running group analysis. When including Dual Regression, make sure to correct your P-value for the number of maps you are comparing. When including Multiple Regression SCA, you must have more degrees of freedom (subjects) than there were time series.</li>
</ol>
<div class="figure">
<img alt="_images/ga_fsl_model2.png" src="_images/ga_fsl_model2.png" />
</div>
<ol class="arabic simple">
<li><strong>Coding Scheme - [Treatment, Sum]:</strong> Select the encoding for your design matrix.  For more details, see Patsy’s pages on <a class="reference external" href="http://patsy.readthedocs.org/en/latest/API-reference.html#patsy.Treatment">Treatment</a> and <a class="reference external" href="http://patsy.readthedocs.org/en/latest/API-reference.html#patsy.Sum">Sum</a> coding.</li>
<li><strong>Mask for Means Calculation - [Group Mask, Individual Mask]:</strong> C-PAC can add the average voxel intensity for a derivative as an EV in the model.  If this average voxel intensity is present in the model, this menu allows you to select either a group-level or individual-level mask.  Otherwise, this menu can be ignored.</li>
<li><strong>Use z-score Standardized Derivatives - [True, False]:</strong> Run model on a z-score standardized version of individual-level outputs or the raw versions.</li>
<li><strong>Z Threshold - [decimal]:</strong> Only voxels with a Z-score higher than this value will be considered significant.</li>
<li><strong>Cluster Significance Threshold - [decimal]:</strong> Significance threshold (P-value) to use when doing cluster correction for multiple comparisons.</li>
<li><strong>Model Group Variances Separately - [Off, On]:</strong> Specify whether FSL should model the variance for each group separately. If this option is enabled, you must specify a grouping variable below.</li>
<li><strong>Grouping Variable - [text]:</strong> The name of the EV that should be used to group subjects when modeling variances. If you do not wish to model group variances separately, set this value to None.</li>
<li><strong>Sessions (Repeated Measures Only) - [dialogue: list of session names]:</strong> Enter the session names in your dataset that you wish to include within the same model (this is for repeated measures/  within-subject designs).  These will be the names listed as “unique_id” in  the original individual-level participant list, or the labels in the original data directories you marked as {session} while creating the C-PAC participant list.  Do not adjust your phenotype CSV- C-PAC will re-formulate it internally before passing it to FLAME.</li>
<li><strong>Series/Scans (Repeated Measures Only) - [dialogue: list of scan names]:</strong>  Enter the series names in your dataset that you wish to include within the same model (this is for repeated measure / within-subject designs).  These will be the labels listed under “rest:” in the original individual-level participant list, or the labels in the original data directories you marked as {series} while creating the C-PAC participant list.  Do not adjust your phenotype CSV- C-PAC will re-formulate it internally before passing it to FLAME.</li>
</ol>
<p>Once you have designed your model, the model builder will save your design in a group configuration YAMl file. As described above, you can then build your models for the derivatives in the pipeline directory selected, from the GUI:</p>
<div class="figure">
<img alt="_images/ga_main_fsl-build.png" src="_images/ga_main_fsl-build.png" />
</div>
<p>Once this is complete, a design matrix will have been generated for each derivative, session, scan, and nuisance regression strategy you had in your pipeline directory. These are available for review in the group-level analysis output directory you specified in your group configuration file (or during preset generation). In addition, a <code class="docutils literal"><span class="pre">contrasts.csv</span></code> file will be generated in the top level of the FSL group model directory (in your selected group-level analysis output directory). This contrasts file will be set up in accordance with the design matrices created for your pipeline outputs, and will look like this:</p>
<div class="figure">
<img alt="_images/ga_contrast_csv.png" src="_images/ga_contrast_csv.png" />
</div>
<p>The first column should be filled with labels for the contrasts that you can define - these do not have to follow any particular convention, and can be whatever works best for your experiment.  The remainder of the cells can be populated with contrast weights according to your needs.</p>
<p>If you would like to add f-tests, add each f-test as a column to the CSV with the label <code class="docutils literal"><span class="pre">f_test_#</span></code> and the assign weights to each contrast to be included in the f-test.</p>
<div class="figure">
<img alt="_images/ga_contrast_ftest.png" src="_images/ga_contrast_ftest.png" />
</div>
<p>Once you have specified your contrasts, you can start FSL FEAT, Randomise, or both from the GUI like so:</p>
<div class="figure">
<img alt="_images/ga_main_fsl-run.png" src="_images/ga_main_fsl-run.png" />
</div>
<p>Note, if you have group configuration options for other types of group-level analyses (ex. PyBASC, MDMR, ISC/ISFC) in the same group configuration file, C-PAC will run all of your analyses for you. You can have all of your group-level analysis setups in one group configuration file, or you can separate them if preferred- both will work.</p>
</div>
<div class="section" id="fsl-randomise-settings">
<h3>FSL Randomise Settings<a class="headerlink" href="#fsl-randomise-settings" title="Permalink to this headline">¶</a></h3>
<p>You can set up FSL Randomise models by using the FSL-FEAT model builder described above. The options in the FSL Randomise Settings tab supplies the configuration decisions for options that are exclusive to FSL Randomise. More information is available on FMRIB’s <a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/Randomise/UserGuide">Randomise User Guide</a>.</p>
<div class="figure">
<img alt="_images/ga_fsl_randomise.png" src="_images/ga_fsl_randomise.png" />
</div>
<ol class="arabic simple">
<li><strong>Run Randomise - [Off, On]:</strong> Whether to run FSL Randomise. Only applies to when you run group analysis through the GUI. This allows you to select multiple types of group-level analyses to run in sequence.</li>
<li><strong>Permutations - [integer]:</strong> Number of permutations you would like to use when building up the null distribution to test against.</li>
<li><strong>Threshold - [integer]:</strong> Cluster-based thresholding corrected for multiple comparisons by using the null distribution of the max (across the image) cluster mask.</li>
<li><strong>Demean - [True/False]:</strong> Demean data temporally before model fitting.</li>
<li><strong>Threshold-Free Cluster Enhancement - [True/False]:</strong> From the FMRIB FSL-Randomise user guide: TFCE (Threshold-Free Cluster Enhancement) is a new method for finding ‘clusters’ in your data with out having to define clusters in a binary way. Cluster-like structures are enhanced but the image remains fundamentally voxelwise.</li>
</ol>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/cpac_logo_vertical.png" alt="Logo"/>
            </a></p>
<h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick.html">1. C-PAC Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">2. Install C-PAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="subject_list_config.html">3. Specify Your Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline_config.html">4. Select Your Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">5. Run C-PAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">6. Pre-Process Your Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="derivatives.html">7. Compute Derivatives</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">8. Run C-PAC</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="group_analysis.html">9. Run Group Analysis</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">FSL FEAT &amp; Randomise</a></li>
<li class="toctree-l2"><a class="reference internal" href="group_pybasc.html">Bootstrapped Analysis of Stable Clusters (PyBASC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="group_mdmr.html">Multivariate Distance Matrix Regression (MDMR)</a></li>
<li class="toctree-l2"><a class="reference internal" href="group_isc.html">Inter-subject Correlation (ISC) &amp; Inter-subject Functional Correlation (ISFC)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="output_dir.html">10. Check Your Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="help.html">11. Troubleshoot</a></li>
<li class="toctree-l1"><a class="reference internal" href="rnotes.html">12. Release Notes</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="group_pybasc.html" title="Bootstrapped Analysis of Stable Clusters (PyBASC)"
             >next</a> |</li>
        <li class="right" >
          <a href="group_analysis.html" title="Group-Level Analysis"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">C-PAC 1.3.0 Beta documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="group_analysis.html" >Group-Level Analysis</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, C-PAC Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-19224662-10"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-19224662-10');
    </script>

  </body>
</html>